jobs:
  include:
  - language: node_js
    node_js:
    - 10.15.0
    services:
    - docker
    cache:
      yarn: true
    before_install:
    - curl -o- -L https://yarnpkg.com/install.sh | bash -s -- --version 1.15.2
    - export PATH=$HOME/.yarn/bin:$PATH
    install:
    - yarn install --frozen-lockfile
    script:
    - yarn run lint
    - yarn workspace @cedalo/machine-core test
    - yarn workspace @cedalo/graphql test
    - yarn workspace @cedalo/webui run local-build
    deploy:
    - provider: script
      script: bash -c "docker login -u $DOCKER_USER -p $DOCKER_PASSWORD && node scripts/deploy.js
        --push --derivative dev --tag develop"
      on:
        branch: master
      skip_cleanup: true
    - provider: script
      script: bash -c 'docker login -u $DOCKER_USER -p $DOCKER_PASSWORD && node scripts/deploy.js
        --push --tag $TRAVIS_TAG'
      on:
        condition: "${TRAVIS_TAG} =~ ^[0-9]+\\.[0-9]+(\\.[0-9]+)?(-rc[0-9]+)?(-bugfix[0-9])?$"
        tags: true
      skip_cleanup: true
notifications:
  slack:
    secure: IclZ9eaz/bfq6LfRSzCddkYOWM2Bp5stp6z/AsEjF7YasCaAX5nnRSxbNpyLUKdoLJ8QBm5oEIF7JltVUNnFOT3XSJ8OBaZ93xg7LJnGF2dDCNnjxkrdCPC3szT3/8NpXKNfbKyxSWwDr61flP5Tkr1MYSVCa4tsZrYkjyu3pJbQDsTg4jB3bAu7W/JvxD+m99wK+LyDhELQk6m3rcuZs5UOJn3WBIayXBZJYo5AFgDqxbst+XFZus+bWAZXFoIetX9n3ri8qEwSiMkp34YqyCvpim+YhNgSzxRrfjsZ4qMnyzmjP0a9NcGD4bVt5AzDKH3nGd9Lo3FtlL2ZvgyZPaFLE00HvqOPZqGD+EUKbX7iDwdMkJNP3b+vYJFUAW7dcTKRa4P7e95qpkFBD28PIxxoWNabHLZ+4odkmbe05tI/rOWlyP1Lunj1zrNE72eqv5OJFiVx7xmiSOlCoabnB065qO7xFyhNDEhMba3YZGPkmLMRdUuQlfHYO1gAtepmlB7OfGDiQuYm5XjehCa5p882THx1ItWyRBsxkfb4JSSr3qBQByCKs8doHvYrIhbAnM6PBB5ET+jRkwAF+MwRnsE6brJWy4rsLnmp50H4NS9KsfFLr7JemU4lz6EtrM6WvcPGblZ3yxOpvCfGTjI5UfJINIVU8c0ug8xH69YJP94=
env:
  global:
  - secure: I6FoBsqo282fNqRF5jYuwuRQz4256OFhdTWw4uqo6adXuIqONL7T9wIJgM4jWHmzQBmULXXlSm3HOskKo9kYKlz6ez7VpP3MB2bguysHJqxp2a1lHa3HXyrCFAyeGGZ0YsRRCxwdKx+8cleusKWzZU722pK/ud6+0JtJRAgC2Z9FAu7uuv1Ug0Bsz4HZvk+g0n7mFuv152kuvek4V7MfvStRkUywI6Coy8j+Unkpf5Ju+qiNXSYJx2ccALfnqQS4z5mU5zEu98y5boL+ckzp+4xFr9rBQlLTBOLRWS1MNWDL4c4mlDRlOxahKlz/QLFXU8bKTgrzm810QKYiwdRY8fwFvAjbir6gFZ/wxlllrR+jIdkOSHd+DogL0aeA6scW2eeSwZXYy0cbtzCpSD22p334JAMadZFrL62KCurcxqODaUTTHZZTTILEzAw0qlYGoLQOAJX95IAD6SkaXqrvE8nDu2pDkOcvIijHKMtvZlN/R9zztgR1pmNEpkqz1sw8P+czCUYjpQVGSY0MfhuMA23rMWA/vFziDv2fIynn++/A59oBz6xZcfBs165Uq958lqZT/X+3eaSG5JFEDFr7cJjDkSrrrvP08i3pTR9OfLVvQdlL/B1Ycjh6vtXR+rb6foTeRFs/X3aO/fY3XrQVuA9M7dGIEQHMfnqople/C2I=
  - secure: OCb3V/kS8b8CRN1tmGDrQ8TMZ1/DzMYUAgKoFipzn7JrpRsqy8BIpbSZ7mHvFpfkiWm6BVAVNb98p+dHbX3t2uwIrgZBSXysEIS9VxBLDzngj7YQ6QzwggpRUskH70Lh252dY18hHAr+U8sDBZJFwMSVfccj7ksm/U8Rg+uCnfyIRWA2hnGWN4ybHmuCGmqOivIj45LZ+I+efhw46cyJWFNOvHV9+ga4CBU/ICLmox08b8rZHbOScbpf/SI+IFc5C7Mhv0gcOAaEio+1dX5AqMouhZEe48Put2Kn5+/Y90VysLG+bOjNMNy9XHSxdQ0WgZzHvNHTxBnZn14nwTAfza+AY/JoWGxFSrBqlRlRdCOVkKj1wa6ku6YOVFPHFPRY53IY6rPAh0gfpholPaLDWmfETPBBB7uCkUX98DFztxMOdnKmnYfhnvXdY0UjVyGGHaAoWI89W9dnbocFLuDsLv1DF3HDzRtR7QmzoNgrnuZkX07Oh7DdQTn7wQSjoyEvoS2aadfwMPyP9CFPSWEe36vHJFvviD7W34m9h2LTOAdZ0V6YE+hUHHyjApXk+WH0LU1J3XAS8jAysNSzuB0gN4jA+5GHLcBoNJTqF9yx+pZYvV0iC49FjTgiZt4OoXn1+POw0LsZgrP97Px/qFKe9yywowIBO+ifF6/6Jt6/Z10=
