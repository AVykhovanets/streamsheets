jobs:
  include:
  - language: node_js
    node_js:
    - 10.15.0
    services:
    - docker
    cache:
      yarn: true
    before_install:
    - curl -o- -L https://yarnpkg.com/install.sh | bash -s -- --version 1.15.2
    - export PATH=$HOME/.yarn/bin:$PATH
    install:
    - yarn install --frozen-lockfile
    script:
    - yarn run lint
    - yarn workspace @cedalo/machine-core test
    - yarn workspace @cedalo/graphql test
    - yarn workspace @cedalo/webui run local-build
    deploy:
    - provider: script
      script: bash -c "docker login -u $DOCKER_USER -p $DOCKER_PASSWORD && node scripts/deploy.js
        --push --derivative dev --tag develop"
      on:
        branch: master
      skip_cleanup: true
    - provider: script
      script: bash -c 'docker login -u $DOCKER_USER -p $DOCKER_PASSWORD && node scripts/deploy.js
        --push --tag $TRAVIS_TAG'
      on:
        condition: "${TRAVIS_TAG} =~ ^[0-9]+\\.[0-9]+(\\.[0-9]+)?(-rc[0-9]+)?(-bugfix[0-9])?$"
        tags: true
      skip_cleanup: true
notifications:
  slack:
    secure: IclZ9eaz/bfq6LfRSzCddkYOWM2Bp5stp6z/AsEjF7YasCaAX5nnRSxbNpyLUKdoLJ8QBm5oEIF7JltVUNnFOT3XSJ8OBaZ93xg7LJnGF2dDCNnjxkrdCPC3szT3/8NpXKNfbKyxSWwDr61flP5Tkr1MYSVCa4tsZrYkjyu3pJbQDsTg4jB3bAu7W/JvxD+m99wK+LyDhELQk6m3rcuZs5UOJn3WBIayXBZJYo5AFgDqxbst+XFZus+bWAZXFoIetX9n3ri8qEwSiMkp34YqyCvpim+YhNgSzxRrfjsZ4qMnyzmjP0a9NcGD4bVt5AzDKH3nGd9Lo3FtlL2ZvgyZPaFLE00HvqOPZqGD+EUKbX7iDwdMkJNP3b+vYJFUAW7dcTKRa4P7e95qpkFBD28PIxxoWNabHLZ+4odkmbe05tI/rOWlyP1Lunj1zrNE72eqv5OJFiVx7xmiSOlCoabnB065qO7xFyhNDEhMba3YZGPkmLMRdUuQlfHYO1gAtepmlB7OfGDiQuYm5XjehCa5p882THx1ItWyRBsxkfb4JSSr3qBQByCKs8doHvYrIhbAnM6PBB5ET+jRkwAF+MwRnsE6brJWy4rsLnmp50H4NS9KsfFLr7JemU4lz6EtrM6WvcPGblZ3yxOpvCfGTjI5UfJINIVU8c0ug8xH69YJP94=
env:
  global:
  - secure: WrGpZ2mf2ASFU7tVmbZI+AiYQx17qLtoJXUKQD3sEopnjH9Gtpg6CusTfaIIyx3haambrlSu0OIL3lY6Q3HR5dJ6uaPUVcpARQ4Opn5oeHRs1TglGC5TldDxLY2q0O3ZLBPDexQyPE499bW4PhmmdAAu3fCBPjL7n+8eK/CiIX9EXt5UupFWOUyQLtccPEHDq8rohnvR/aSa43vl5lndoNx8eJNdfd36q0g7eXZAdohULOVOE+0tb31S0uFBTlzvkpU9jcA7stm4uMH9jJAK6D7v1VcmGkqo4LLc8ufwE7pGAP7YnDm0fGvUtOO69fEa2XiJIl9Z0JYQMA+RiiFOblZWeJkwdYp78ooGULHF0t1H1pNYGtMJOaeLAdBfFRnDZKt4ZiIOELEDIEjUoYri3MJG00Ur5LK38N6h0w2wi4tkfAj7V+PhJ+qYCcKMFOa75/IexFxTF5nUmd4mDlV2cv+SPzLRKUojKBuoA+EIrRouZfvoie7nxRwirmOd0Cle2nSEcGWp3qK0WjswPVmpw6aJWJ3glctZe5gZD+SrsSp3zjlvCGHk+kglprAUhHmENSMpOKDH8fxhroX71tt9xZhz0d+D0lgSqmqpde1smgfnztHQcKWBwiw/y7KcWG1sNPV7OJ9StgQyFFb+1HCArlaW/ZXys2+LtV1LQdiNDGs=
  - secure: GqWQiDpS1n+Mrw4yj/sBFoAW1N94oNJo1kRD/k/DWiPU614uNwVTpmi9IQ1nvFYgtjH/y+9n2LCWlSKC3kOUEzoCoTsY8xPR4elJ3mfQaDHUo8sGKI1adNv1Hu9qN8lNVMMQO0mUPJj8w0V8ElSZ27XlCJdnPRJy2sVbTjiURbrB5sYu86yvfaRWp4p2WBTNgEnnYFtQ/LQ1geX3OKvyD1CytecRXhldvX77UkyqYKyPmLVjpZzwfXnQcx2BmeY8JsXOQaStwDUQDhjeH2Xg9jcUkGigQmrU8SUegA7nbmHp+zkaNRxI2FeeTBx1zQkS4joyMQyuFqsSK1rlIxe/INep5HoAOMUYxTx/szFA8QdEmmoMlrRPZLfY+tGm7U+uMjihRuld+rFwabqbv1fncssBySN00kA3D5sJXoY6IvwSU4aEcz2VJFd41h6yxiMAHnD/vbLhjfl0T1yDfKB1RIxhxctH56WGTOS2ZOVtm7lBRjdDWpANiFw+w1i4DoGfebyojNMEmjdz0zPdIQrcDsY12qrhk3lWm7XuEQBk2Iy0YpyaWxE010ewOVHozGs+up7wCBOEfXn+G8zPWyt3Zo+9virIG1hYAVTbfu4m9m7X+hHZ2u/jC5nO955mgAf3V4xlt7ejfQ5kz4mlZP7T5aZd0Q8o9yIyt7UxBqlt0Gk=
  - secure: cgM57fZs1v7A7l/ta+a7RROCx1sFNAGRiXU2j2EADWa0Mor0Lwq4naafBsCaEegwZCImywEzjO4icrKBGl1rqotBiLlyAcMgYXLWJUMiJYdovxTY8Ig4jFv+rO0VYPOj1kvOXKE94Y0eIJHqucDepSoGCU2SOW0ytvEBnGCMp/EaXFVkEgGvH6Pv84Q1PD98W8qzh7dCSswiR3qWlev2HMb3xntOgC2JjBytQDw6SDp3wlqpYvWk8SfBaHHhapB00z9ZONZCoPFH/JEjjswW10BiOdzrQ575w/zh4Msi9jv/fF+QJayB1ZUPr1gOmR+m2MROEE0c4POUMxrwRN4nm1uC5cWmPn20w6d7bnyI17DZTWqdz2rs47oP5wPkc9WRXVwNU4UX7Ts6/SSYZ2cUQfMmHBUQcSfTYKgy+qQmRZPiwaLE2LKwObyw8Yp7qSuGezSF/lFwMbZleUqEngeIqqlB/9u4Wumt94xArfxXA8LUS/bq5E/B74VNE8+Q8J0+JuVyclNPTuFDnswwlT1YSmbWVVxL535lmiChbf8W78c5xCk4PLe6Vk+hLDTXiDSDJZrI2auLQoyiJw/i0jaEGFR5ntiwIcVoYs/8//e5K03ukSmnmS2zgDCnx5mvht5MipHTysJExoXLHFnBIcSvnLlru6LmwOFddkU6TTZ1kzs=
  - secure: mR5MmdtaNo/4fQ5FFv1nsRfFPvqrCynGULrmdJG8gywkRzqifGSfLwxYB7b+L4hIaXtcF2zX+//ZTjpA6PRa4NkRQkVMpZLJlFM2q6RNjMveHZArMt2VzsPMBmRoc3MfJZ4okrCXDBcamtxHd49+NvnUbd8d9Voip185XX1TMEMswlzjfcImZVNWhlBuyizAyUDomccRVz5JX6hsCxAgImATL9JyW0Q7sQChx0iwBXjmU5nVt4iKtsn7Z8Sqkf6Un1b4emQDjCb4zS1ef2Jntgrh7NVopSDeBcaaAvjl87vvAV0t+HEXk3aUJ1mClu26k2f3FZeJwL61fJN3lw2Ys+7L5Q0mMz+mXKdAi3V/mfKe7bCYTw01DfKOUJhbeZOou0NkwUbLLIlcFBax7n8b0mmvevWTHRKMx0mWfz+JwLCoeieWPiwwDtfN41Do6eafuhxIqZxgXFHlGD8VSrv3lc3IjPLxky27iVGOZnET3LL5CIO4sFPzSPDBb9z8moHNSSFpcULB+H6mvilCkWNgzzjdAgtfkcVgReRePPqK5PXhR9V3AhzJERmZzjCyXkCHKEyIMvCzoW+ddljxfFUf9F7RUpOuvYSUSZxJ9bIuVCEoLJoxGwQu5P/ZqXG6rvUO7ipql3qMRFTHYB9pIuV7lpPlwyRJkJypuFFLi0NZDBg=
