jobs:
  include:
  - language: node_js
    node_js:
    - 10.15.0
    services:
    - docker
    cache:
      yarn: true
    before_install:
    - curl -o- -L https://yarnpkg.com/install.sh | bash -s -- --version 1.15.2
    - export PATH=$HOME/.yarn/bin:$PATH
    install:
    - yarn install --frozen-lockfile
    script:
    - yarn run lint
    - yarn workspace @cedalo/machine-core test
    - yarn workspace @cedalo/graphql test
    - yarn workspace @cedalo/webui run local-build
    deploy:
    - provider: script
      script: bash -c "docker login -u $DOCKER_USER -p $DOCKER_PASSWORD && node scripts/deploy.js
        --push --derivative dev --tag develop"
      on:
        branch: master
      skip_cleanup: true
    - provider: script
      script: bash -c 'docker login -u $DOCKER_USER -p $DOCKER_PASSWORD && node scripts/deploy.js
        --push --tag $TRAVIS_TAG'
      on:
        condition: "${TRAVIS_TAG} =~ ^[0-9]+\\.[0-9]+(\\.[0-9]+)?(-rc[0-9]+)?(-bugfix[0-9])?$"
        tags: true
      skip_cleanup: true
notifications:
  slack:
    secure: IclZ9eaz/bfq6LfRSzCddkYOWM2Bp5stp6z/AsEjF7YasCaAX5nnRSxbNpyLUKdoLJ8QBm5oEIF7JltVUNnFOT3XSJ8OBaZ93xg7LJnGF2dDCNnjxkrdCPC3szT3/8NpXKNfbKyxSWwDr61flP5Tkr1MYSVCa4tsZrYkjyu3pJbQDsTg4jB3bAu7W/JvxD+m99wK+LyDhELQk6m3rcuZs5UOJn3WBIayXBZJYo5AFgDqxbst+XFZus+bWAZXFoIetX9n3ri8qEwSiMkp34YqyCvpim+YhNgSzxRrfjsZ4qMnyzmjP0a9NcGD4bVt5AzDKH3nGd9Lo3FtlL2ZvgyZPaFLE00HvqOPZqGD+EUKbX7iDwdMkJNP3b+vYJFUAW7dcTKRa4P7e95qpkFBD28PIxxoWNabHLZ+4odkmbe05tI/rOWlyP1Lunj1zrNE72eqv5OJFiVx7xmiSOlCoabnB065qO7xFyhNDEhMba3YZGPkmLMRdUuQlfHYO1gAtepmlB7OfGDiQuYm5XjehCa5p882THx1ItWyRBsxkfb4JSSr3qBQByCKs8doHvYrIhbAnM6PBB5ET+jRkwAF+MwRnsE6brJWy4rsLnmp50H4NS9KsfFLr7JemU4lz6EtrM6WvcPGblZ3yxOpvCfGTjI5UfJINIVU8c0ug8xH69YJP94=
env:
  global:
  - secure: myWJ7j+C7WjwgN4Y9SZXwbkLqL9CYrOFwJ+P1WYBZWOksk1aqgCiZD1KWpZomWhnOg1BiqSZIIJk5BSbuYy8KCtf3wp+AC2H6ImYO2pvSQ/ooZruTdJdyL6wkJc4WhSs9BR66A5zJnqlFU3REOUSqDYl5Ayc3rTYcGPrXX4cASYF4m9Gr8PfFAtkVgYbjN4pGc7+61/UeGoKiCCvu+3EVEpA3gWfybq29uede0ud2uLKrM9lspQxLkAV4E/5LYZvli7/XBOhgHoMIva2p2BBSdjL/47ALpzE3MbF4pc+AbEkBsCCs7o70V4phTUoC47psw2yNEoWkotZQtMpHqO6bQduPCz5uj+Ve4BJGRCuxYO6YCxUNLdFVcJoXsgXfN6700n5UymYS/ksFtB5mJ/CxcBmNc2fZ6Sh9H5emhZkysPcmmgE4kjASof8ubT9T0oepf4cqbgsepCMDaR3lc/mPQjCZWXciYxXh4w7yfVCw1DVdax4THpwixJ9xv6mArZHMQri9pHIael7M6xgScSzNfHfKnPu3u3GGlcBPikSAWojhSwhJr0o/vNq/GMmilFVKnFQp9XYsvA+xC8pswYEHeoJYByYqbUy0QJ/UCJo9K8F98ow6YM3nLXNx25liXIJDv70YhXRLIHlBmGUJZ4KxsWdaAg+e3mcFcxwLMgo4wI=
  - secure: lCdem0wZqVAbfcalkUpScReulAsSZWIbFb6GJPNIF0P6dzBLwic5m+LHRe/2FbG8fdDqDFQqnRGAqo1KZrBnA8DAi18Whrt5kutpHbQLdrOsr0xWi6CpW4ZETkfDMkovaYbudO5lL+pXpPP4VHEslgUlxA7pQd7FX2FF2mI4W6GvM9guUANTcXth+0Sdd0pT6CuNt4R7BzWtGsVOr5gHo8cAuipXJjZZvGu9xfPnNRerRv1aMauD5nCOH+AB0JmUeD5WAwaA6Ca/wvC1MJDGe9vTlP+tGjQVPLzn4iWWEkViHuPQIvshSeQSi5t5J262fCbrauYcn6uXVWZepF4H+scGNiZ7xhLTWQT7h4HpqJOXehPb8dlfSg/saUqBKnlp9VxkeDBF5U7nidpN5AEMCERNXcdQyC2TmeNzxxigLOpaTT2q10no26jtPZDSTl7QvNfPme1wbdhGo8NkXesD8Esswm4sQf2o6YlkQmte2/XtxW77FjFYHnwU6pSQk8kuN6byiD5TWnKWTHNw8lapRMYMw5xusMat/cJi6rbszoat2TZ0WGZ1uDxRIfA9xbuZpUY2ORtuDPKOMtGyZB6RbbzzpVrzpGp6ciLQTxcuKOxNcL6oza77c1UkZWKr92yy/kT1XTtqqqg2SbzEsO5jgm38aqlBErK+0aHvMsAOeEI=
